{"version":3,"file":"ngx-gallery-gallerize.umd.js.map","sources":["ng://@ngx-gallery/gallerize/lib/gallerize.directive.ts","ng://@ngx-gallery/gallerize/lib/gallerize.module.ts"],"sourcesContent":["import {\r\n  Directive,\r\n  Input,\r\n  OnInit,\r\n  OnDestroy,\r\n  Inject,\r\n  Optional,\r\n  Self,\r\n  Host,\r\n  NgZone,\r\n  ElementRef,\r\n  Renderer2,\r\n  PLATFORM_ID\r\n} from '@angular/core';\r\nimport { DOCUMENT, isPlatformBrowser } from '@angular/common';\r\n\r\nimport { Gallery, GalleryRef, ImageItem, GalleryComponent, GalleryState, GalleryItem } from '@ngx-gallery/core';\r\nimport { Lightbox } from '@ngx-gallery/lightbox';\r\n\r\nimport { Subject, Subscription, from, EMPTY } from 'rxjs';\r\nimport { tap, map, switchMap, finalize, debounceTime } from 'rxjs/operators';\r\n\r\n/**\r\n * This directive has 2 modes:\r\n * 1 - If host element is a HTMLElement, it detects the images and hooks their clicks to lightbox\r\n * 2 - If host element is a GalleryComponent, it hooks the images click to the lightbox\r\n */\r\n\r\nconst enum GallerizeMode {\r\n  Detector = 'detector',\r\n  Gallery = 'gallery'\r\n}\r\n\r\n@Directive({\r\n  selector: '[gallerize]'\r\n})\r\nexport class GallerizeDirective implements OnInit, OnDestroy {\r\n\r\n  /** Default gallery id */\r\n  private _galleryId = 'lightbox';\r\n\r\n  /** Gallerize mode */\r\n  private readonly _mode: GallerizeMode;\r\n\r\n  /** If host element is a HTMLElement, will use the following variables: */\r\n\r\n  /** Stream that emits to fire the detection stream the image elements has changed */\r\n  private _observer$: any;\r\n\r\n  /** Stream that emits when image is discover */\r\n  private _detector$: Subject<any>;\r\n\r\n  /** If host element is a GalleryComponent, will use the following variables: */\r\n\r\n  /** Gallery events (if used on a gallery component) */\r\n  private _itemClick$: Subscription;\r\n  private _itemChange$: Subscription;\r\n\r\n  // ======================================================\r\n\r\n  /** If set, it will become the gallery id */\r\n  @Input() gallerize: string;\r\n\r\n  /** The selector used to query images elements */\r\n  @Input() selector = 'img';\r\n\r\n  constructor(private _zone: NgZone,\r\n              private _el: ElementRef,\r\n              private _gallery: Gallery,\r\n              private _lightbox: Lightbox,\r\n              private _renderer: Renderer2,\r\n              @Inject(PLATFORM_ID) platform: Object,\r\n              @Inject(DOCUMENT) private _document: any,\r\n              @Host() @Self() @Optional() private _galleryCmp: GalleryComponent) {\r\n\r\n    // Set gallerize mode\r\n    if (isPlatformBrowser(platform)) {\r\n      this._mode = _galleryCmp ? GallerizeMode.Gallery : GallerizeMode.Detector;\r\n    }\r\n  }\r\n\r\n  ngOnInit() {\r\n    this._zone.runOutsideAngular(() => {\r\n      this._galleryId = this.gallerize || this._galleryId;\r\n      const ref = this._gallery.ref(this._galleryId);\r\n\r\n      switch (this._mode) {\r\n        case GallerizeMode.Detector:\r\n          this.detectorMode(ref);\r\n          break;\r\n        case GallerizeMode.Gallery:\r\n          this.galleryMode(ref);\r\n      }\r\n    });\r\n  }\r\n\r\n  ngOnDestroy() {\r\n    switch (this._mode) {\r\n      case GallerizeMode.Detector:\r\n        this._detector$.complete();\r\n        this._observer$.disconnect();\r\n        break;\r\n      case GallerizeMode.Gallery:\r\n        this._itemClick$.unsubscribe();\r\n        this._itemChange$.unsubscribe();\r\n    }\r\n  }\r\n\r\n  /** Gallery mode: means `gallerize` directive is used on `<gallery>` component\r\n   * Adds a click event to each gallery item so it opens in lightbox */\r\n  private galleryMode(galleryRef: GalleryRef) {\r\n    // Clone its items to the new gallery instance\r\n    this._itemClick$ = this._galleryCmp.galleryRef.itemClick.subscribe((i: number) => this._lightbox.open(i, this._galleryId));\r\n    this._itemChange$ = this._galleryCmp.galleryRef.itemsChanged.subscribe((state: GalleryState) => galleryRef.load(state.items));\r\n  }\r\n\r\n  /** Detector mode: means `gallerize` directive is used on a normal HTMLElement\r\n   *  Detects images and adds a click event to each image so it opens in the lightbox */\r\n  private detectorMode(galleryRef: GalleryRef) {\r\n    this._detector$ = new Subject();\r\n    // Query image elements\r\n    this._detector$.pipe(\r\n      debounceTime(300),\r\n      switchMap(() => {\r\n\r\n        /** get all img elements from content */\r\n        const imageElements = this._el.nativeElement.querySelectorAll(this.selector);\r\n\r\n        if (imageElements && imageElements.length) {\r\n\r\n          const images: GalleryItem[] = [];\r\n\r\n          return from(imageElements).pipe(\r\n            map((el: any, i) => {\r\n              // Add click event to the image\r\n              this._renderer.setStyle(el, 'cursor', 'pointer');\r\n              this._renderer.setProperty(el, 'onclick', () =>\r\n                this._zone.run(() => this._lightbox.open(i, this._galleryId))\r\n              );\r\n\r\n              if (el instanceof HTMLImageElement) {\r\n                // If element is type of img use the src property\r\n                return {\r\n                  src: el.getAttribute('imageSrc') || el.src,\r\n                  thumb: el.getAttribute('thumbSrc') || el.src\r\n                };\r\n              } else {\r\n                // Otherwise, use element background-image url\r\n                const elStyle = el.currentStyle || this._document.defaultView.getComputedStyle(el, null);\r\n                const background = elStyle.backgroundImage.slice(4, -1).replace(/\"/g, '');\r\n                return {\r\n                  src: el.getAttribute('imageSrc') || background,\r\n                  thumb: el.getAttribute('thumbSrc') || background\r\n                };\r\n              }\r\n            }),\r\n            tap((data: any) => images.push(new ImageItem(data))),\r\n            finalize(() => galleryRef.load(images))\r\n          );\r\n        } else {\r\n          return EMPTY;\r\n        }\r\n      })\r\n    ).subscribe();\r\n\r\n    // Observe content changes\r\n    this._observer$ = new MutationObserver(() => this._detector$.next());\r\n    this._observer$.observe(this._el.nativeElement, {childList: true, subtree: true});\r\n  }\r\n}\r\n","import { NgModule } from '@angular/core';\r\nimport { GalleryModule } from '@ngx-gallery/core';\r\nimport { LightboxModule } from '@ngx-gallery/lightbox';\r\nimport { GallerizeDirective } from './gallerize.directive';\r\n\r\n@NgModule({\r\n  imports: [\r\n    GalleryModule,\r\n    LightboxModule\r\n  ],\r\n  declarations: [GallerizeDirective],\r\n  exports: [GallerizeDirective]\r\n})\r\nexport class GallerizeModule {\r\n\r\n}\r\n"],"names":["isPlatformBrowser","Subject","debounceTime","switchMap","from","map","tap","ImageItem","finalize","EMPTY","Directive","NgZone","ElementRef","Gallery","Lightbox","Renderer2","Inject","PLATFORM_ID","DOCUMENT","GalleryComponent","Host","Self","Optional","Input","NgModule","GalleryModule","LightboxModule"],"mappings":"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"}
